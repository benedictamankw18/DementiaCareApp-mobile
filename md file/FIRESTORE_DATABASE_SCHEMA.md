# FIRESTORE DATABASE SCHEMA DESIGN

## Dementia Care Mobile Application

**Project Title:** Design and Development of a Dementia Care Mobile Application for Patient and Caregiver Support

**Database Type:** Cloud Firestore (NoSQL Document Database)

**Date:** January 7, 2026

---

## TABLE OF CONTENTS

1. [Database Overview](#1-database-overview)
2. [Collection Structures](#2-collection-structures)
3. [Field Data Types and Constraints](#3-field-data-types-and-constraints)
4. [Data Relationships](#4-data-relationships)
5. [Firestore Security Rules](#5-firestore-security-rules)
6. [Indexes and Query Patterns](#6-indexes-and-query-patterns)
7. [Example Documents](#7-example-documents)
8. [Data Retention and Cleanup](#8-data-retention-and-cleanup)
9. [Backup and Recovery](#9-backup-and-recovery)
10. [Schema Design Justification](#10-schema-design-justification)

---

## 1. DATABASE OVERVIEW

### 1.1 Why Firestore for This Project?

| Advantage                     | Benefit for Dementia Care App                                                           |
| ----------------------------- | --------------------------------------------------------------------------------------- |
| **Real-Time Synchronization** | Instant updates when caregivers modify reminders or patients complete activities        |
| **Offline-First Capability**  | App works without internet; syncs when connection returns (important for elderly users) |
| **Document-Based (NoSQL)**    | Flexible schema allows storing diverse data (reminders, games, location) in single DB   |
| **Built-in Security Rules**   | Role-based access control without custom authorization server                           |
| **Automatic Backup**          | Firebase handles daily backups; no manual intervention needed                           |
| **Scalability**               | Automatically scales from 1 user to millions without code changes                       |

### 1.2 Database Design Principles

**Principle 1: User Privacy First**

- Patient data protected by default
- Caregivers access only linked patient data
- Explicit consent required for location tracking

**Principle 2: Simple Data Model**

- Flat structure (minimal nesting) for easier querying
- Denormalization where it improves performance
- Clear collection names understandable for documentation

**Principle 3: Audit Trail**

- All critical operations timestamped
- Consent records maintain history
- Activity logs track what patient/caregiver did

**Principle 4: Dementia-Friendly**

- Large, clear data organization
- Simple field names (not cryptic abbreviations)
- Minimal data complexity for frontend developers

---

## 2. COLLECTION STRUCTURES

### 2.1 Users Collection

**Path:** `/users/{userId}`

**Purpose:** Store user profiles, preferences, and authentication metadata

**Document Structure:**

```firestore
{
  userId: string (auto-generated by Firebase Auth)
  â”œâ”€â”€ Authentication Info
  â”‚  â”œâ”€â”€ email: string
  â”‚  â”œâ”€â”€ emailVerified: boolean
  â”‚  â”œâ”€â”€ createdAt: timestamp
  â”‚  â””â”€â”€ lastSignInAt: timestamp
  â”‚
  â”œâ”€â”€ Profile Information
  â”‚  â”œâ”€â”€ fullName: string (required)
  â”‚  â”œâ”€â”€ role: string ("patient" | "caregiver") [required]
  â”‚  â”œâ”€â”€ dateOfBirth: timestamp (required)
  â”‚  â”œâ”€â”€ phoneNumber: string
  â”‚  â”œâ”€â”€ profilePhotoURL: string
  â”‚  â”œâ”€â”€ gender: string ("male" | "female" | "other")
  â”‚  â””â”€â”€ bio: string (short description)
  â”‚
  â”œâ”€â”€ Relationship Info (For Caregivers)
  â”‚  â”œâ”€â”€ linkedPatients: array of strings [patientIds]
  â”‚  â””â”€â”€ relationshipTypes: map {patientId: "family" | "professional" | "friend"}
  â”‚
  â”œâ”€â”€ Relationship Info (For Patients)
  â”‚  â”œâ”€â”€ linkedCaregivers: array of strings [caregiverIds]
  â”‚  â””â”€â”€ emergencyContacts: array of objects
  â”‚     â””â”€â”€ [
  â”‚        {
  â”‚          name: string,
  â”‚          phoneNumber: string,
  â”‚          relationship: string
  â”‚        }
  â”‚     ]
  â”‚
  â”œâ”€â”€ Preferences
  â”‚  â”œâ”€â”€ notificationsEnabled: boolean (default: true)
  â”‚  â”œâ”€â”€ soundEnabled: boolean (default: true)
  â”‚  â”œâ”€â”€ vibrationEnabled: boolean (default: true)
  â”‚  â”œâ”€â”€ fontSize: number (18-22 pt, default: 18)
  â”‚  â”œâ”€â”€ highContrastEnabled: boolean (default: false)
  â”‚  â”œâ”€â”€ locationSharingEnabled: boolean (default: false)
  â”‚  â”œâ”€â”€ locationUpdateInterval: number (minutes, default: 10)
  â”‚  â”œâ”€â”€ language: string ("en" | "es" | "fr", default: "en")
  â”‚  â””â”€â”€ theme: string ("light" | "dark", default: "light")
  â”‚
  â”œâ”€â”€ Account Status
  â”‚  â”œâ”€â”€ isActive: boolean (default: true)
  â”‚  â”œâ”€â”€ isSuspended: boolean (default: false)
  â”‚  â”œâ”€â”€ suspendReason: string (optional)
  â”‚  â””â”€â”€ deletedAt: timestamp (soft delete)
  â”‚
  â””â”€â”€ Metadata
     â”œâ”€â”€ updatedAt: timestamp
     â””â”€â”€ updatedBy: string (userId of person who made changes)
}
```

**Constraints:**

- `email` must be unique (handled by Firebase Auth)
- `role` is required and immutable
- `fullName` minimum 2 characters, maximum 100
- `fontSize` must be 18-22
- For caregivers: `linkedPatients` array must not be empty

**Example Document:**

```json
{
  "email": "john.doe@example.com",
  "emailVerified": true,
  "createdAt": "2024-01-15T10:30:00Z",
  "lastSignInAt": "2024-01-20T14:45:30Z",
  "fullName": "John Doe",
  "role": "caregiver",
  "dateOfBirth": "1965-05-20T00:00:00Z",
  "phoneNumber": "+1-555-0123",
  "profilePhotoURL": "https://firebasestorage.googleapis.com/...",
  "gender": "male",
  "bio": "Registered nurse caring for my mother",
  "linkedPatients": ["patient-001", "patient-002"],
  "relationshipTypes": {
    "patient-001": "family",
    "patient-002": "professional"
  },
  "notificationsEnabled": true,
  "soundEnabled": true,
  "vibrationEnabled": true,
  "fontSize": 18,
  "highContrastEnabled": false,
  "locationSharingEnabled": true,
  "locationUpdateInterval": 10,
  "language": "en",
  "theme": "light",
  "isActive": true,
  "isSuspended": false,
  "updatedAt": "2024-01-20T14:45:30Z",
  "updatedBy": "user-admin-001"
}
```

---

### 2.2 Reminders Collection

**Path:** `/reminders/{reminderId}`

**Purpose:** Store medication reminders, task reminders, and activity reminders

**Document Structure:**

```firestore
{
  reminderId: string (auto-generated)
  â”œâ”€â”€ Ownership & Association
  â”‚  â”œâ”€â”€ patientId: string [required, foreign key to /users]
  â”‚  â”œâ”€â”€ caregiverId: string [required, foreign key to /users]
  â”‚  â””â”€â”€ linkedPatientName: string (denormalized for display)
  â”‚
  â”œâ”€â”€ Reminder Details
  â”‚  â”œâ”€â”€ type: string ("medication" | "task" | "activity") [required]
  â”‚  â”œâ”€â”€ title: string [required] (e.g., "Take Blood Pressure Medicine")
  â”‚  â”œâ”€â”€ description: string (optional, detailed instructions)
  â”‚  â”œâ”€â”€ medicationName: string (if type = "medication")
  â”‚  â”œâ”€â”€ dosage: string (if type = "medication", e.g., "2 tablets")
  â”‚  â”œâ”€â”€ frequency: string ("once" | "daily" | "weekly" | "custom") [required]
  â”‚  â””â”€â”€ frequency_details: map
  â”‚     â”œâ”€â”€ nextReminderTime: timestamp
  â”‚     â”œâ”€â”€ recurrenceDays: array of strings ["MON", "WED", "FRI"]
  â”‚     â””â”€â”€ endDate: timestamp (optional, when reminder stops)
  â”‚
  â”œâ”€â”€ Timing Information
  â”‚  â”œâ”€â”€ createdAt: timestamp
  â”‚  â”œâ”€â”€ updatedAt: timestamp
  â”‚  â”œâ”€â”€ scheduledTime: timestamp [required] (next reminder time)
  â”‚  â”œâ”€â”€ completedAt: timestamp (when patient marked as done)
  â”‚  â”œâ”€â”€ missedAt: timestamp (if reminder was missed/ignored)
  â”‚  â””â”€â”€ lastModifiedBy: string (userId)
  â”‚
  â”œâ”€â”€ Completion Status
  â”‚  â”œâ”€â”€ isCompleted: boolean (default: false)
  â”‚  â”œâ”€â”€ completionCount: number (for recurring reminders)
  â”‚  â”œâ”€â”€ missedCount: number (tracked for adherence)
  â”‚  â”œâ”€â”€ completionNotes: string (what patient wrote when completing)
  â”‚  â””â”€â”€ completionPhotos: array of strings (URLs, if patient attaches photos)
  â”‚
  â”œâ”€â”€ Notification Settings
  â”‚  â”œâ”€â”€ notificationEnabled: boolean (default: true)
  â”‚  â”œâ”€â”€ soundEnabled: boolean
  â”‚  â”œâ”€â”€ vibrationEnabled: boolean
  â”‚  â”œâ”€â”€ notificationTime: number (minutes before reminder, e.g., 15)
  â”‚  â””â”€â”€ repeatNotification: boolean (keep notifying until completed?)
  â”‚
  â”œâ”€â”€ Status
  â”‚  â”œâ”€â”€ isActive: boolean (default: true)
  â”‚  â”œâ”€â”€ isPaused: boolean (default: false)
  â”‚  â”œâ”€â”€ pausedAt: timestamp
  â”‚  â””â”€â”€ pausedReason: string (optional)
  â”‚
  â””â”€â”€ Metadata
     â”œâ”€â”€ reminderColor: string (hex, for UI display, e.g., "#FF5733")
     â”œâ”€â”€ reminderIcon: string (emoji or icon type)
     â””â”€â”€ priority: string ("low" | "normal" | "high")
}
```

**Constraints:**

- `patientId` must exist in `/users` collection
- `caregiverId` must exist in `/users` collection
- `caregiverId` must be linked to `patientId` (verified in security rules)
- `scheduledTime` must be in future
- `frequency` must match valid values
- `type` must match valid values

**Example Document:**

```json
{
  "patientId": "patient-001",
  "caregiverId": "caregiver-001",
  "linkedPatientName": "Mary Smith",
  "type": "medication",
  "title": "Take Blood Pressure Medicine",
  "description": "Take one tablet of Lisinopril 10mg with water",
  "medicationName": "Lisinopril",
  "dosage": "1 tablet (10mg)",
  "frequency": "daily",
  "frequency_details": {
    "nextReminderTime": "2024-01-21T09:00:00Z",
    "recurrenceDays": null,
    "endDate": "2024-12-31T23:59:59Z"
  },
  "createdAt": "2024-01-15T10:30:00Z",
  "updatedAt": "2024-01-15T10:30:00Z",
  "scheduledTime": "2024-01-21T09:00:00Z",
  "completedAt": "2024-01-20T09:15:00Z",
  "missedAt": null,
  "lastModifiedBy": "caregiver-001",
  "isCompleted": true,
  "completionCount": 15,
  "missedCount": 2,
  "completionNotes": "Took medicine with breakfast",
  "completionPhotos": [],
  "notificationEnabled": true,
  "soundEnabled": true,
  "vibrationEnabled": true,
  "notificationTime": 15,
  "repeatNotification": true,
  "isActive": true,
  "isPaused": false,
  "pausedAt": null,
  "pausedReason": null,
  "reminderColor": "#FF5733",
  "reminderIcon": "ðŸ’Š",
  "priority": "high"
}
```

---

### 2.3 Activities Collection

**Path:** `/activities/{activityId}`

**Purpose:** Log all patient activities (completed reminders, games played, SOS events, etc.)

**Document Structure:**

```firestore
{
  activityId: string (auto-generated)
  â”œâ”€â”€ Ownership
  â”‚  â”œâ”€â”€ patientId: string [required, foreign key to /users]
  â”‚  â””â”€â”€ recordedBy: string (userId who logged activity - system or caregiver)
  â”‚
  â”œâ”€â”€ Activity Information
  â”‚  â”œâ”€â”€ type: string ("reminder_completed" | "reminder_missed" | "game_played" |
  â”‚  â”‚            "sos_triggered" | "location_update" | "consent_granted" |
  â”‚  â”‚            "reminder_created" | "custom_activity") [required]
  â”‚  â”œâ”€â”€ title: string [required] (human-readable activity title)
  â”‚  â”œâ”€â”€ description: string (detailed description of activity)
  â”‚  â”œâ”€â”€ timestamp: timestamp [required] (when activity occurred)
  â”‚  â””â”€â”€ category: string ("health" | "wellness" | "social" | "emergency")
  â”‚
  â”œâ”€â”€ Activity-Specific Data (Conditional)
  â”‚  â””â”€â”€ metadata: map (varies by activity type)
  â”‚     â”œâ”€â”€ For reminder_completed:
  â”‚     â”‚  â”œâ”€â”€ reminderId: string
  â”‚     â”‚  â”œâ”€â”€ reminderTitle: string
  â”‚     â”‚  â””â”€â”€ completionNotes: string
  â”‚     â”‚
  â”‚     â”œâ”€â”€ For game_played:
  â”‚     â”‚  â”œâ”€â”€ gameId: string
  â”‚     â”‚  â”œâ”€â”€ gameName: string
  â”‚     â”‚  â”œâ”€â”€ score: number
  â”‚     â”‚  â”œâ”€â”€ durationSeconds: number
  â”‚     â”‚  â””â”€â”€ difficulty: string ("easy" | "medium" | "hard")
  â”‚     â”‚
  â”‚     â”œâ”€â”€ For sos_triggered:
  â”‚     â”‚  â”œâ”€â”€ locationLatitude: number
  â”‚     â”‚  â”œâ”€â”€ locationLongitude: number
  â”‚     â”‚  â”œâ”€â”€ locationAccuracy: number
  â”‚     â”‚  â”œâ”€â”€ notifiedCaregiverCount: number
  â”‚     â”‚  â””â”€â”€ sosResolved: boolean
  â”‚     â”‚
  â”‚     â””â”€â”€ For location_update:
  â”‚        â”œâ”€â”€ latitude: number
  â”‚        â”œâ”€â”€ longitude: number
  â”‚        â”œâ”€â”€ accuracy: number (in meters)
  â”‚        â””â”€â”€ address: string (reverse geocoded)
  â”‚
  â”œâ”€â”€ Visibility & Access
  â”‚  â”œâ”€â”€ viewableBy: array of strings [caregiver userIds who can see this]
  â”‚  â”œâ”€â”€ views: map
  â”‚  â”‚  â””â”€â”€ {caregiverId: {
  â”‚  â”‚       viewedAt: timestamp,
  â”‚  â”‚       acknowledged: boolean
  â”‚  â”‚     }}
  â”‚  â””â”€â”€ isPublic: boolean (default: false)
  â”‚
  â”œâ”€â”€ Status
  â”‚  â”œâ”€â”€ isDeleted: boolean (soft delete, default: false)
  â”‚  â”œâ”€â”€ deletedAt: timestamp
  â”‚  â””â”€â”€ deletedBy: string (userId who deleted)
  â”‚
  â””â”€â”€ Metadata
     â”œâ”€â”€ deviceInfo: string (which device logged this)
     â””â”€â”€ emergencyFlags: array (if multiple concerns in one activity)
}
```

**Constraints:**

- `patientId` must exist in `/users`
- `timestamp` cannot be in future
- `type` must match valid values
- For SOS activities: location data should be present
- Activities are append-only (not modified after creation, only soft-deleted)

**Example Document:**

```json
{
  "patientId": "patient-001",
  "recordedBy": "system",
  "type": "reminder_completed",
  "title": "Medication Reminder Completed",
  "description": "Mary completed her blood pressure medication reminder",
  "timestamp": "2024-01-20T09:15:00Z",
  "category": "health",
  "metadata": {
    "reminderId": "reminder-001",
    "reminderTitle": "Take Blood Pressure Medicine",
    "completionNotes": "Took with breakfast"
  },
  "viewableBy": ["caregiver-001", "caregiver-002"],
  "views": {
    "caregiver-001": {
      "viewedAt": "2024-01-20T10:00:00Z",
      "acknowledged": true
    },
    "caregiver-002": {
      "viewedAt": null,
      "acknowledged": false
    }
  },
  "isPublic": false,
  "isDeleted": false,
  "deletedAt": null,
  "deletedBy": null,
  "deviceInfo": "Samsung A12",
  "emergencyFlags": []
}
```

---

### 2.4 GPS_Locations Collection

**Path:** `/gps_locations/{locationId}`

**Purpose:** Store patient location history with timestamp and accuracy data

**Document Structure:**

```firestore
{
  locationId: string (auto-generated)
  â”œâ”€â”€ Location Ownership
  â”‚  â”œâ”€â”€ patientId: string [required, foreign key to /users]
  â”‚  â””â”€â”€ caregiverId: string (caregiver who has permission to view)
  â”‚
  â”œâ”€â”€ Geographic Data
  â”‚  â”œâ”€â”€ latitude: number [required] (-90 to 90)
  â”‚  â”œâ”€â”€ longitude: number [required] (-180 to 180)
  â”‚  â”œâ”€â”€ accuracy: number [required] (in meters, e.g., 5.5)
  â”‚  â”œâ”€â”€ altitude: number (optional, elevation in meters)
  â”‚  â”œâ”€â”€ bearing: number (optional, direction 0-360)
  â”‚  â””â”€â”€ speed: number (optional, speed in m/s)
  â”‚
  â”œâ”€â”€ Address Information
  â”‚  â”œâ”€â”€ address: string (human-readable address from reverse geocoding)
  â”‚  â”œâ”€â”€ city: string
  â”‚  â”œâ”€â”€ state: string
  â”‚  â”œâ”€â”€ zipCode: string
  â”‚  â”œâ”€â”€ country: string
  â”‚  â””â”€â”€ placeName: string (e.g., "Home", "Hospital", "Park")
  â”‚
  â”œâ”€â”€ Timestamp & Context
  â”‚  â”œâ”€â”€ timestamp: timestamp [required] (when location was captured)
  â”‚  â”œâ”€â”€ recordedBy: string (how it was recorded - "GPS" | "cell_tower" | "manual")
  â”‚  â””â”€â”€ source: string (app version that recorded it)
  â”‚
  â”œâ”€â”€ Consent & Privacy
  â”‚  â”œâ”€â”€ consentVerified: boolean [required] (must verify consent before storing)
  â”‚  â”œâ”€â”€ consentRecordId: string (reference to /consent_records)
  â”‚  â””â”€â”€ isHistorical: boolean (false for real-time, true for archived)
  â”‚
  â””â”€â”€ Metadata
     â”œâ”€â”€ isDeleted: boolean (soft delete)
     â””â”€â”€ deletedAt: timestamp
}
```

**Constraints:**

- `patientId` must exist in `/users` and have `locationSharingEnabled: true`
- `latitude` and `longitude` must be valid coordinates
- `accuracy` must be positive number
- `consentVerified` must be true (enforced in security rules)
- Location data automatically deleted after 90 days (retention policy)

**Example Document:**

```json
{
  "patientId": "patient-001",
  "caregiverId": "caregiver-001",
  "latitude": 40.7128,
  "longitude": -74.006,
  "accuracy": 5.5,
  "altitude": 10.5,
  "bearing": 45.0,
  "speed": 1.2,
  "address": "123 Main Street, New York, NY 10001",
  "city": "New York",
  "state": "NY",
  "zipCode": "10001",
  "country": "USA",
  "placeName": "Home",
  "timestamp": "2024-01-20T14:30:00Z",
  "recordedBy": "GPS",
  "source": "DementiaCareApp v1.0",
  "consentVerified": true,
  "consentRecordId": "consent-001",
  "isHistorical": false,
  "isDeleted": false,
  "deletedAt": null
}
```

---

### 2.5 Consent_Records Collection

**Path:** `/consent_records/{consentId}`

**Purpose:** Maintain audit trail of all consent given/revoked for data access and sharing

**Document Structure:**

```firestore
{
  consentId: string (auto-generated)
  â”œâ”€â”€ Parties Involved
  â”‚  â”œâ”€â”€ patientId: string [required, foreign key to /users]
  â”‚  â”œâ”€â”€ caregiverId: string [required, foreign key to /users]
  â”‚  â””â”€â”€ consentGivenBy: string (userId who granted consent - patient or guardian)
  â”‚
  â”œâ”€â”€ Consent Details
  â”‚  â”œâ”€â”€ consentType: array of strings [required]
  â”‚  â”‚  â””â”€â”€ Possible values:
  â”‚  â”‚     "location_tracking" | "activity_monitoring" |
  â”‚  â”‚     "reminder_management" | "medication_tracking" |
  â”‚  â”‚     "emergency_alerts" | "photo_access" | "contact_access"
  â”‚  â”œâ”€â”€ scope: string ("specific_tasks" | "all_activities" | "emergency_only")
  â”‚  â””â”€â”€ description: string (human-readable consent explanation)
  â”‚
  â”œâ”€â”€ Consent Status
  â”‚  â”œâ”€â”€ isGranted: boolean [required] (true = granted, false = revoked)
  â”‚  â”œâ”€â”€ grantedAt: timestamp [required]
  â”‚  â”œâ”€â”€ revokedAt: timestamp (when consent was withdrawn)
  â”‚  â”œâ”€â”€ expiresAt: timestamp (optional, consent auto-expires)
  â”‚  â””â”€â”€ status: string ("active" | "expired" | "revoked" | "pending")
  â”‚
  â”œâ”€â”€ Audit Trail
  â”‚  â”œâ”€â”€ notes: string (why consent was given/revoked)
  â”‚  â”œâ”€â”€ history: array of objects (complete change history)
  â”‚  â”‚  â””â”€â”€ [{
  â”‚  â”‚       timestamp: timestamp,
  â”‚  â”‚       action: string ("granted" | "revoked"),
  â”‚  â”‚       changedBy: string (userId),
  â”‚  â”‚       reason: string,
  â”‚  â”‚       consentTypes: array of strings
  â”‚  â”‚     }, ...]
  â”‚  â””â”€â”€ lastModifiedAt: timestamp
  â”‚
  â””â”€â”€ Metadata
     â”œâ”€â”€ consentForm: string (URL to original consent form signed by patient)
     â”œâ”€â”€ deviceFingerprint: string (which device consent was given from)
     â””â”€â”€ ipAddress: string (anonymized, for audit)
}
```

**Constraints:**

- Both `patientId` and `caregiverId` must exist in `/users`
- `consentType` array must contain valid types
- `isGranted` true requires `grantedAt` timestamp
- If `isGranted` false, `revokedAt` must be present
- `grantedAt` must be before `revokedAt` (if revoked)

**Example Document:**

```json
{
  "patientId": "patient-001",
  "caregiverId": "caregiver-001",
  "consentGivenBy": "patient-001",
  "consentType": [
    "location_tracking",
    "activity_monitoring",
    "emergency_alerts"
  ],
  "scope": "all_activities",
  "description": "Mary consents to location tracking and activity monitoring by her primary caregiver John",
  "isGranted": true,
  "grantedAt": "2024-01-15T10:30:00Z",
  "revokedAt": null,
  "expiresAt": "2025-01-15T10:30:00Z",
  "status": "active",
  "notes": "Signed during initial account setup",
  "history": [
    {
      "timestamp": "2024-01-15T10:30:00Z",
      "action": "granted",
      "changedBy": "patient-001",
      "reason": "Initial setup",
      "consentTypes": [
        "location_tracking",
        "activity_monitoring",
        "emergency_alerts"
      ]
    }
  ],
  "lastModifiedAt": "2024-01-15T10:30:00Z",
  "consentForm": "https://firebasestorage.googleapis.com/consent-form-001.pdf",
  "deviceFingerprint": "device-xyz-123",
  "ipAddress": "192.168.x.x"
}
```

---

### 2.6 Caregiver_Relationships Collection

**Path:** `/caregiver_relationships/{relationshipId}`

**Purpose:** Define and manage relationships between caregivers and patients

**Document Structure:**

```firestore
{
  relationshipId: string (auto-generated)
  â”œâ”€â”€ Relationship Parties
  â”‚  â”œâ”€â”€ patientId: string [required, foreign key to /users]
  â”‚  â”œâ”€â”€ caregiverId: string [required, foreign key to /users]
  â”‚  â””â”€â”€ linkedBy: string (userId who created the link - usually patient or admin)
  â”‚
  â”œâ”€â”€ Relationship Type
  â”‚  â”œâ”€â”€ relationshipType: string [required]
  â”‚  â”‚  â””â”€â”€ Possible values: "family" | "professional" | "friend" | "healthcare_provider"
  â”‚  â”œâ”€â”€ relationshipDetail: string (e.g., "daughter", "nurse", "best friend")
  â”‚  â””â”€â”€ primaryCaregiver: boolean (is this the main contact?)
  â”‚
  â”œâ”€â”€ Relationship Status
  â”‚  â”œâ”€â”€ status: string ("active" | "pending" | "suspended" | "revoked") [required]
  â”‚  â”œâ”€â”€ createdAt: timestamp [required]
  â”‚  â”œâ”€â”€ activatedAt: timestamp (when link was confirmed)
  â”‚  â”œâ”€â”€ revokedAt: timestamp (when link was removed)
  â”‚  â””â”€â”€ revokeReason: string (optional)
  â”‚
  â”œâ”€â”€ Permissions
  â”‚  â”œâ”€â”€ permissions: array of strings
  â”‚  â”‚  â””â”€â”€ Possible values:
  â”‚  â”‚     "view_location" | "manage_reminders" | "view_activities" |
  â”‚  â”‚     "receive_emergencies" | "edit_profile" | "manage_caregivers"
  â”‚  â””â”€â”€ customPermissions: map (for granular control)
  â”‚     â”œâ”€â”€ canViewMedications: boolean
  â”‚     â”œâ”€â”€ canViewGames: boolean
  â”‚     â”œâ”€â”€ canCreateReminders: boolean
  â”‚     â”œâ”€â”€ canDeleteReminders: boolean
  â”‚     â””â”€â”€ canViewLocation: boolean
  â”‚
  â”œâ”€â”€ Notification Settings
  â”‚  â”œâ”€â”€ emergencyAlertsEnabled: boolean (default: true)
  â”‚  â”œâ”€â”€ activityUpdatesEnabled: boolean (default: true)
  â”‚  â”œâ”€â”€ reminderUpdatesEnabled: boolean (default: false)
  â”‚  â””â”€â”€ notificationFrequency: string ("real_time" | "daily_digest" | "manual")
  â”‚
  â””â”€â”€ Metadata
     â”œâ”€â”€ updatedAt: timestamp
     â”œâ”€â”€ lastActiveAt: timestamp (caregiver's last login)
     â””â”€â”€ notes: string (caregiver notes about relationship)
}
```

**Constraints:**

- `patientId` must exist in `/users` with role "patient"
- `caregiverId` must exist in `/users` with role "caregiver"
- `status` transitions: "pending" â†’ "active" â†’ "suspended" or "pending" â†’ "revoked"
- `permissions` array must contain valid permission strings
- Each patient-caregiver pair can have only ONE relationship record

**Example Document:**

```json
{
  "patientId": "patient-001",
  "caregiverId": "caregiver-001",
  "linkedBy": "patient-001",
  "relationshipType": "family",
  "relationshipDetail": "daughter",
  "primaryCaregiver": true,
  "status": "active",
  "createdAt": "2024-01-15T10:30:00Z",
  "activatedAt": "2024-01-15T11:00:00Z",
  "revokedAt": null,
  "revokeReason": null,
  "permissions": [
    "view_location",
    "manage_reminders",
    "view_activities",
    "receive_emergencies",
    "edit_profile"
  ],
  "customPermissions": {
    "canViewMedications": true,
    "canViewGames": true,
    "canCreateReminders": true,
    "canDeleteReminders": true,
    "canViewLocation": true
  },
  "emergencyAlertsEnabled": true,
  "activityUpdatesEnabled": true,
  "reminderUpdatesEnabled": true,
  "notificationFrequency": "real_time",
  "updatedAt": "2024-01-20T14:30:00Z",
  "lastActiveAt": "2024-01-20T14:30:00Z",
  "notes": "Daughter who checks in daily, manages all reminders"
}
```

---

### 2.7 Games Collection (Optional - For Cognitive Activities)

**Path:** `/games/{gameId}`

**Purpose:** Store information about cognitive games for patients

**Document Structure:**

```firestore
{
  gameId: string (auto-generated)
  â”œâ”€â”€ Game Information
  â”‚  â”œâ”€â”€ title: string [required] (e.g., "Memory Match")
  â”‚  â”œâ”€â”€ description: string
  â”‚  â”œâ”€â”€ category: string ("memory" | "puzzle" | "word" | "brain_training")
  â”‚  â”œâ”€â”€ difficulty: string ("easy" | "medium" | "hard")
  â”‚  â””â”€â”€ instructions: string (how to play)
  â”‚
  â”œâ”€â”€ Game Settings
  â”‚  â”œâ”€â”€ isActive: boolean (is this game available?)
  â”‚  â”œâ”€â”€ minPlayers: number
  â”‚  â”œâ”€â”€ maxPlayers: number
  â”‚  â”œâ”€â”€ estimatedDuration: number (minutes)
  â”‚  â””â”€â”€ rules: string
  â”‚
  â”œâ”€â”€ Accessibility
  â”‚  â”œâ”€â”€ largeText: boolean
  â”‚  â”œâ”€â”€ highContrast: boolean
  â”‚  â”œâ”€â”€ soundSupport: boolean
  â”‚  â””â”€â”€ simpleNavigation: boolean
  â”‚
  â””â”€â”€ Metadata
     â”œâ”€â”€ createdAt: timestamp
     â”œâ”€â”€ updatedAt: timestamp
     â””â”€â”€ developedBy: string (therapist/developer name)
}
```

---

## 3. FIELD DATA TYPES AND CONSTRAINTS

### 3.1 Field Data Type Reference

| Data Type        | Firestore Type | Size Limit          | Examples                  |
| ---------------- | -------------- | ------------------- | ------------------------- |
| **string**       | String         | 1 MB                | "John Doe", "patient-001" |
| **number**       | Number         | 64-bit              | 42, 3.14, -100            |
| **boolean**      | Boolean        | 1 bit               | true, false               |
| **timestamp**    | Timestamp      | 64-bit              | 2024-01-15T10:30:00Z      |
| **array**        | Array          | 20,000 elements max | ["item1", "item2"]        |
| **map (object)** | Map            | nested structure    | {name: "John", age: 30}   |
| **reference**    | Reference      | document path       | /users/patient-001        |
| **null**         | Null           | 1 bit               | null (missing field)      |

### 3.2 Field Validation Rules

**Users Collection:**

```
- email: Email format validation (@example.com)
- fullName: 2-100 characters, non-empty
- role: Enum: "patient" | "caregiver"
- phoneNumber: Optional, valid phone format
- fontSize: Integer 18-22
- dateOfBirth: Must be before today
```

**Reminders Collection:**

```
- title: 1-200 characters, non-empty
- frequency: Enum: "once" | "daily" | "weekly" | "custom"
- scheduledTime: Must be timestamp in future
- medicationName: 1-100 characters (if type = medication)
- dosage: 1-50 characters (if type = medication)
- notificationTime: 0-60 minutes
```

**GPS_Locations Collection:**

```
- latitude: Float -90.0 to 90.0
- longitude: Float -180.0 to 180.0
- accuracy: Positive number (meters)
- altitude: Optional, positive or negative number
- speed: Optional, non-negative number (m/s)
```

**Activities Collection:**

```
- type: Enum (multiple valid values)
- timestamp: Past timestamp, not in future
- title: 1-200 characters, non-empty
```

---

## 4. DATA RELATIONSHIPS

### 4.1 Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USERS     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ userId (PK) â”‚
â”‚ email       â”‚
â”‚ role        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                         â”‚
       â–¼                         â–¼
  (Patient)              (Caregiver)
       â”‚                         â”‚
       â”‚                         â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚ (1 to Many)
                    â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ CAREGIVER_RELATIONSHIPS â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚ relationshipId (PK)      â”‚
       â”‚ patientId (FK)          â”‚
       â”‚ caregiverId (FK)        â”‚
       â”‚ status                  â”‚
       â”‚ permissions             â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ (1 to Many)
                    â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ CONSENT_RECORDS         â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚ consentId (PK)          â”‚
       â”‚ patientId (FK)          â”‚
       â”‚ caregiverId (FK)        â”‚
       â”‚ consentType             â”‚
       â”‚ isGranted               â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Patient
   â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚             â”‚              â”‚              â”‚
   â–¼             â–¼              â–¼              â–¼
REMINDERS   ACTIVITIES   GPS_LOCATIONS    GAMES


Relationship Legend:
PK = Primary Key (unique identifier)
FK = Foreign Key (reference to another collection)
(1 to Many) = One user linked to many records
```

### 4.2 Foreign Key Relationships

| From                    | To    | Field                  | Relationship | Cascade                                   |
| ----------------------- | ----- | ---------------------- | ------------ | ----------------------------------------- |
| Reminders               | Users | patientId, caregiverId | Many-to-One  | Soft delete reminders if user deleted     |
| Activities              | Users | patientId              | Many-to-One  | Soft delete activities if patient deleted |
| GPS_Locations           | Users | patientId              | Many-to-One  | Auto-delete locations after 90 days       |
| Consent_Records         | Users | patientId, caregiverId | Many-to-One  | Archive consent if user deleted           |
| Caregiver_Relationships | Users | patientId, caregiverId | Many-to-One  | Revoke relationship if user deleted       |

---

## 5. FIRESTORE SECURITY RULES

### 5.1 Security Rules Overview

**Design Principle:** Least Privilege Access - users cannot access data by default; explicit rules grant access.

### 5.2 Complete Security Rules

```javascript
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ==================== HELPER FUNCTIONS ====================

    // Check if user is authenticated
    function isAuthenticated() {
      return request.auth != null;
    }

    // Get current user ID
    function currentUserID() {
      return request.auth.uid;
    }

    // Get current user's role
    function userRole() {
      return get(/databases/$(database)/documents/users/$(currentUserID())).data.role;
    }

    // Check if user is a patient
    function isPatient() {
      return userRole() == 'patient';
    }

    // Check if user is a caregiver
    function isCaregiver() {
      return userRole() == 'caregiver';
    }

    // Check if caregiver is linked to patient
    function isCaregiverOf(patientId) {
      return exists(/databases/$(database)/documents/caregiver_relationships/$(patientId)_$(currentUserID())) &&
             get(/databases/$(database)/documents/caregiver_relationships/$(patientId)_$(currentUserID())).data.status == 'active';
    }

    // Check if consent is granted
    function hasConsent(patientId, consentType) {
      let consent = get(/databases/$(database)/documents/consent_records/$(patientId)_$(currentUserID()));
      return consent.data.isGranted == true &&
             consentType in consent.data.consentType;
    }

    // ==================== USERS COLLECTION ====================

    match /users/{userId} {
      // Users can read their own document
      allow read: if isAuthenticated() && currentUserID() == userId;

      // Users can write their own document (update preferences, profile)
      allow write: if isAuthenticated() && currentUserID() == userId;

      // Caregivers can read linked patient profiles (for display)
      allow read: if isAuthenticated() && isCaregiver() &&
                     isCaregiverOf(userId);

      // Only admins can create new users (handled by Firebase Auth)
      allow create: if isAuthenticated() && request.auth.token.admin == true;

      // Users cannot modify their own role
      allow update: if isAuthenticated() && currentUserID() == userId &&
                       !('role' in request.data.keys());
    }

    // ==================== REMINDERS COLLECTION ====================

    match /reminders/{reminderId} {
      let patientId = resource.data.patientId;
      let caregiverId = resource.data.caregiverId;

      // Patients can read their own reminders
      allow read: if isAuthenticated() && isPatient() &&
                     currentUserID() == patientId;

      // Caregivers can read reminders for their linked patients
      allow read: if isAuthenticated() && isCaregiver() &&
                     isCaregiverOf(patientId);

      // Patients can update their own reminders (mark as complete)
      allow update: if isAuthenticated() && isPatient() &&
                       currentUserID() == patientId &&
                       request.data.patientId == resource.data.patientId &&
                       request.data.caregiverId == resource.data.caregiverId;

      // Caregivers can create reminders for their linked patients
      allow create: if isAuthenticated() && isCaregiver() &&
                       request.data.caregiverId == currentUserID() &&
                       isCaregiverOf(request.data.patientId);

      // Caregivers can update reminders they created
      allow update: if isAuthenticated() && isCaregiver() &&
                       caregiverId == currentUserID() &&
                       isCaregiverOf(patientId);

      // Caregivers can delete reminders they created
      allow delete: if isAuthenticated() && isCaregiver() &&
                       caregiverId == currentUserID() &&
                       isCaregiverOf(patientId);
    }

    // ==================== ACTIVITIES COLLECTION ====================

    match /activities/{activityId} {
      let patientId = resource.data.patientId;
      let viewableBy = resource.data.viewableBy;

      // Patients can read their own activities
      allow read: if isAuthenticated() && isPatient() &&
                     currentUserID() == patientId;

      // Caregivers can read patient activities they're allowed to view
      allow read: if isAuthenticated() && isCaregiver() &&
                     currentUserID() in viewableBy &&
                     isCaregiverOf(patientId);

      // Only system can create activities
      allow create: if false; // Should be created via Cloud Functions

      // Activities are immutable (no updates)
      allow update: if false;

      // Caregivers can soft-delete activities
      allow delete: if isAuthenticated() && isCaregiver() &&
                       isCaregiverOf(patientId);
    }

    // ==================== GPS_LOCATIONS COLLECTION ====================

    match /gps_locations/{locationId} {
      let patientId = resource.data.patientId;

      // Patients can read their own location data
      allow read: if isAuthenticated() && isPatient() &&
                     currentUserID() == patientId;

      // Caregivers can read location if:
      // 1. They are linked to patient AND
      // 2. Consent is granted for location tracking
      allow read: if isAuthenticated() && isCaregiver() &&
                     isCaregiverOf(patientId) &&
                     hasConsent(patientId, 'location_tracking');

      // Only system/app can write locations
      allow create: if isAuthenticated() && isPatient() &&
                       request.data.patientId == currentUserID() &&
                       request.data.consentVerified == true;

      // Locations are immutable after creation
      allow update: if false;

      // Locations auto-deleted after 90 days (via Cloud Function)
      allow delete: if false;
    }

    // ==================== CONSENT_RECORDS COLLECTION ====================

    match /consent_records/{consentId} {
      let patientId = resource.data.patientId;
      let caregiverId = resource.data.caregiverId;

      // Patients can read and manage their consent records
      allow read: if isAuthenticated() && isPatient() &&
                     currentUserID() == patientId;

      // Caregivers can read consent records related to them
      allow read: if isAuthenticated() && isCaregiver() &&
                     currentUserID() == caregiverId;

      // Patients can create consent records
      allow create: if isAuthenticated() && isPatient() &&
                       request.data.patientId == currentUserID();

      // Patients can update their consent records
      allow update: if isAuthenticated() && isPatient() &&
                       request.data.patientId == currentUserID();

      // Patients can revoke consent
      allow delete: if isAuthenticated() && isPatient() &&
                       currentUserID() == patientId;
    }

    // ==================== CAREGIVER_RELATIONSHIPS COLLECTION ====================

    match /caregiver_relationships/{relationshipId} {
      let patientId = resource.data.patientId;
      let caregiverId = resource.data.caregiverId;

      // Both patient and caregiver can read the relationship
      allow read: if isAuthenticated() &&
                     (currentUserID() == patientId ||
                      currentUserID() == caregiverId);

      // Patients can create relationship links
      allow create: if isAuthenticated() && isPatient() &&
                       request.data.patientId == currentUserID();

      // Patients can update and delete relationships
      allow update, delete: if isAuthenticated() && isPatient() &&
                               patientId == currentUserID();

      // Caregivers can accept pending relationships
      allow update: if isAuthenticated() && isCaregiver() &&
                       caregiverId == currentUserID() &&
                       resource.data.status == 'pending' &&
                       request.data.status == 'active';
    }

    // ==================== GAMES COLLECTION ====================

    match /games/{gameId} {
      // All authenticated users can read available games
      allow read: if isAuthenticated();

      // Only admins can create/update/delete games
      allow write: if request.auth.token.admin == true;
    }

    // ==================== CATCH-ALL ====================

    // Default: deny all access
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
```

### 5.3 Security Rules Explanation

| Rule                                           | Purpose       | Protection                                     |
| ---------------------------------------------- | ------------- | ---------------------------------------------- |
| Users can only read/write own profile          | Privacy       | Prevents users from viewing other user data    |
| Caregivers can only access linked patient data | Privacy       | Caregiver-patient relationship verified        |
| Location access requires explicit consent      | Compliance    | GDPR-compliant consent mechanism               |
| Activities immutable after creation            | Audit trail   | Prevents tampering with activity logs          |
| Relationship status verification               | Authorization | Ensures only active relationships grant access |

---

## 6. INDEXES AND QUERY PATTERNS

### 6.1 Composite Indexes Required

**For optimal query performance, create these composite indexes in Firebase Console:**

| Collection              | Fields                               | Query Purpose                       |
| ----------------------- | ------------------------------------ | ----------------------------------- |
| Reminders               | patientId, scheduledTime (Ascending) | Get upcoming reminders for patient  |
| Reminders               | patientId, isCompleted               | Get completed reminders for patient |
| Activities              | patientId, timestamp (Descending)    | Get activity history for patient    |
| GPS_Locations           | patientId, timestamp (Descending)    | Get location history for patient    |
| Caregiver_Relationships | patientId, status                    | Get active caregivers for patient   |
| Consent_Records         | patientId, isGranted                 | Get active consents for patient     |

### 6.2 Query Patterns

**Pattern 1: Get All Upcoming Reminders for Patient**

```javascript
db.collection("reminders")
  .where("patientId", "==", "patient-001")
  .where("scheduledTime", ">", new Date())
  .where("isActive", "==", true)
  .orderBy("scheduledTime", "asc")
  .limit(10)
  .get();
```

**Pattern 2: Get Activity History for Patient**

```javascript
db.collection("activities")
  .where("patientId", "==", "patient-001")
  .where("isDeleted", "==", false)
  .orderBy("timestamp", "desc")
  .limit(50)
  .get();
```

**Pattern 3: Get Patient's Current Location**

```javascript
db.collection("gps_locations")
  .where("patientId", "==", "patient-001")
  .orderBy("timestamp", "desc")
  .limit(1)
  .get();
```

**Pattern 4: Get All Linked Caregivers for Patient**

```javascript
db.collection("caregiver_relationships")
  .where("patientId", "==", "patient-001")
  .where("status", "==", "active")
  .get();
```

**Pattern 5: Get Active Consents for Caregiver-Patient Pair**

```javascript
db.collection("consent_records")
  .where("patientId", "==", "patient-001")
  .where("caregiverId", "==", "caregiver-001")
  .where("isGranted", "==", true)
  .get();
```

---

## 7. EXAMPLE DOCUMENTS

### 7.1 Complete User Document (Patient)

```json
{
  "userId": "patient-001",
  "email": "mary.smith@example.com",
  "emailVerified": true,
  "createdAt": "2024-01-01T08:00:00Z",
  "lastSignInAt": "2024-01-20T14:30:00Z",
  "fullName": "Mary Smith",
  "role": "patient",
  "dateOfBirth": "1945-03-15T00:00:00Z",
  "phoneNumber": "+1-555-0101",
  "profilePhotoURL": "https://firebasestorage.googleapis.com/mary.jpg",
  "gender": "female",
  "bio": "Enjoying life with support from family",
  "linkedCaregivers": ["caregiver-001", "caregiver-002"],
  "emergencyContacts": [
    {
      "name": "John Smith",
      "phoneNumber": "+1-555-0102",
      "relationship": "Son"
    },
    {
      "name": "Sarah Johnson",
      "phoneNumber": "+1-555-0103",
      "relationship": "Daughter"
    }
  ],
  "notificationsEnabled": true,
  "soundEnabled": true,
  "vibrationEnabled": true,
  "fontSize": 20,
  "highContrastEnabled": true,
  "locationSharingEnabled": true,
  "locationUpdateInterval": 10,
  "language": "en",
  "theme": "light",
  "isActive": true,
  "isSuspended": false,
  "updatedAt": "2024-01-20T14:30:00Z",
  "updatedBy": "system"
}
```

### 7.2 Complete Reminder Document

```json
{
  "reminderId": "reminder-med-001",
  "patientId": "patient-001",
  "caregiverId": "caregiver-001",
  "linkedPatientName": "Mary Smith",
  "type": "medication",
  "title": "Take Morning Blood Pressure Medicine",
  "description": "Take one tablet of Lisinopril 10mg with water and food",
  "medicationName": "Lisinopril",
  "dosage": "1 tablet (10mg)",
  "frequency": "daily",
  "frequency_details": {
    "nextReminderTime": "2024-01-22T09:00:00Z",
    "recurrenceDays": null,
    "endDate": "2024-12-31T23:59:59Z"
  },
  "createdAt": "2024-01-10T10:00:00Z",
  "updatedAt": "2024-01-20T14:00:00Z",
  "scheduledTime": "2024-01-21T09:00:00Z",
  "completedAt": "2024-01-20T09:15:00Z",
  "missedAt": null,
  "lastModifiedBy": "caregiver-001",
  "isCompleted": true,
  "completionCount": 20,
  "missedCount": 1,
  "completionNotes": "Took with breakfast",
  "completionPhotos": [],
  "notificationEnabled": true,
  "soundEnabled": true,
  "vibrationEnabled": true,
  "notificationTime": 15,
  "repeatNotification": true,
  "isActive": true,
  "isPaused": false,
  "pausedAt": null,
  "pausedReason": null,
  "reminderColor": "#FF5733",
  "reminderIcon": "ðŸ’Š",
  "priority": "high"
}
```

---

## 8. DATA RETENTION AND CLEANUP

### 8.1 Retention Policies

| Data Type            | Retention Period | Cleanup Method                      | Justification                  |
| -------------------- | ---------------- | ----------------------------------- | ------------------------------ |
| GPS Locations        | 90 days          | Automatic Cloud Function            | Privacy, storage optimization  |
| Activity Logs        | 2 years          | Archive to cold storage             | Audit trail, GDPR compliance   |
| Consent Records      | Permanent        | Archive after 3 years               | Legal/compliance requirement   |
| Deleted User Data    | 30 days          | Hard delete (soft delete initially) | GDPR "Right to be Forgotten"   |
| Reminder Completions | 1 year           | Archive                             | Historical tracking for health |

### 8.2 Cloud Function for Data Cleanup (Pseudo-code)

```javascript
// Scheduled Cloud Function (runs daily)
exports.cleanupOldData = functions.pubsub
  .schedule("every day 02:00")
  .timeZone("America/New_York")
  .onRun(async (context) => {
    // Delete GPS locations older than 90 days
    const ninetyDaysAgo = new Date(Date.now() - 90 * 24 * 60 * 60 * 1000);

    const oldLocations = await db
      .collection("gps_locations")
      .where("timestamp", "<", ninetyDaysAgo)
      .where("isDeleted", "==", false)
      .get();

    // Batch delete
    const batch = db.batch();
    oldLocations.docs.forEach((doc) => {
      batch.delete(doc.ref);
    });

    await batch.commit();
    console.log(`Deleted ${oldLocations.docs.length} old location records`);
  });
```

---

## 9. BACKUP AND RECOVERY

### 9.1 Firebase Automatic Backups

Firebase Firestore automatically backs up data:

- **Frequency:** Daily automatic backups
- **Retention:** 30-day backup history
- **Region:** Same region as database
- **Access:** Via Firebase Console

### 9.2 Manual Backup Strategy

For additional protection:

1. Export data monthly using Firestore export feature
2. Store exports in Cloud Storage
3. Archive exports to cold storage after 1 year
4. Test restore procedures quarterly

### 9.3 Recovery Procedures

**Scenario 1: Accidental Data Deletion**

- Restore from 30-day automatic backup
- Time: 5-10 minutes
- Process: Firebase Console â†’ Backups â†’ Restore

**Scenario 2: Data Corruption**

- Identify corrupted documents
- Revert to previous backup
- Run validation checks on restored data

---

## 10. SCHEMA DESIGN JUSTIFICATION

### 10.1 Design Decisions

| Decision                                                     | Why This Approach                                            | Alternative Considered                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------ |
| **Separate Collections for Each Entity Type**                | Easier querying, better performance, clear data organization | Single nested collection (harder to query) |
| **Denormalization (storing linkedPatientName in Reminders)** | Faster display without extra queries                         | Pure normalization (requires joins)        |
| **Soft Delete (isDeleted flag)**                             | Audit trail, can restore data                                | Hard delete (permanent loss)               |
| **Timestamp for All Changes**                                | Complete audit trail for healthcare compliance               | No timestamps (can't track changes)        |
| **Role-Based Security Rules**                                | Protects patient privacy, complies with healthcare standards | No security rules (security vulnerability) |
| **Explicit Consent Records**                                 | GDPR compliance, user control, audit trail                   | Implicit consent (risky legally)           |

### 10.2 Scalability Considerations

**Current Design Handles:**

- 10,000 patients with 5 caregivers each = 50,000 relationships âœ“
- 100 reminders per patient per year = 1,000,000 total reminders âœ“
- 1 location update every 10 minutes = 144,000 updates/day âœ“
- Real-time queries for 100 concurrent users âœ“

**If scaling beyond:**

- Add horizontal sharding for high-volume collections
- Implement caching layer (Redis) for frequently accessed data
- Archive old activities to separate collection after 1 year

---

## 11. SCHEMA VERSIONING

### 11.1 Handling Schema Changes

When adding new fields:

1. Add new field to document
2. Set default value for existing documents
3. Update security rules if needed
4. Update app code to handle both old and new versions

**Example: Adding "emergencyContactPhone" to Activities**

- Old docs: field missing (will be undefined in app)
- New docs: field present with value
- App: checks field existence with optional chaining (?.)

---

## 12. CONCLUSION

This Firestore schema design provides:

âœ… **Complete Data Model** - All necessary collections for dementia care app  
âœ… **Security-First Design** - Role-based access, explicit consent, audit trails  
âœ… **Healthcare Compliance** - GDPR-ready, data retention policies  
âœ… **Performance Optimization** - Proper indexes, efficient queries  
âœ… **Scalability** - Handles thousands of users and millions of records  
âœ… **Maintainability** - Clear structure, well-documented, easy to extend  
âœ… **Academic Quality** - Suitable for project report and defense

The schema balances **normalization** (for data integrity) with **denormalization** (for performance), uses **soft deletes** for audit trails, and implements **explicit consent** for regulatory compliance.

---

**Document Version:** 1.0  
**Date:** January 7, 2026  
**Status:** Ready for Project Report (Chapter 4)
